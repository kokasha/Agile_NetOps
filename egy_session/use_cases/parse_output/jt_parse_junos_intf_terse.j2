{# Header for the CSV File #}
interface,intf_op_status,vrf,ip_address
{% for unit in logical_units %}
{# Condition to remove empty Unit with no Data #}
{%  if unit['logical-interface'] is defined %}
{# Test to check if this unit is dictionary or not (INTERFACE WITH SINGLE UNIT) #}
{# IN JUNIPER DATA STRUCTURE IF THE INTERFACE HAS MULTIPLE UNITS #}
{# THE DEVICE WILL PRODUCE AT LIST FOR ALL THE UNITS UNDER THIS INTERFACE #}
{# THIS COVER THE CASE WHERE WE HAVE SINGLE SUBINTERFACES UNDER THE SAME MAIN INTERFACE#}
{%      if unit['logical-interface'] is mapping %}
{# Limit search only for 1G or 10G or Loopback Interfaces #}
{%          if unit['logical-interface'].name[:3] in ['ge-','xe-'] %}
{%              set intf_name = unit['logical-interface'].name %}
{%              set intf_vrf = unit['logical-interface'].vrfname %}
{%              set intf_op_status = unit['logical-interface']['oper-status'] %}
{%              set intf_ifd = unit['logical-interface']['address-family'] %}
{%              if  intf_ifd is not mapping %} {# test is it is a list or not#}
{%                  for af in intf_ifd %}
{%                      if af['address-family-name'] == 'inet' and af['interface-address'] is defined %}
{%                          set intf_af = af['address-family-name']%}
{%                          set intf_ip = af['interface-address']['ifa-local'] %}
{{intf_name}},{{intf_op_status}},{{intf_vrf}},{{intf_af}},{{intf_ip}}
{%                      elif af['address-family-name'] == 'inet' %}
{%                          set intf_af = af['address-family-name']%}
{%                          set intf_ip = '**** IP INTERFACE WITH NO IP ****' %}
{{intf_name}},{{intf_op_status}},{{intf_vrf}},{{intf_af}},{{intf_ip}}
{%                      elif af['address-family-name'] == 'vpls' %}
{%                          set intf_af = af['address-family-name']%}
{%                          set intf_ip = '**** NON IP INTERFACE ****' %}
{{intf_name}},{{intf_op_status}},{{intf_vrf}},{{intf_af}},{{intf_ip}}
{%                      endif%}
{%                  endfor%}
{%              else%}
{{intf_name}},{{intf_op_status}},{{intf_vrf}},{{intf_ifd}}
{%              endif%}
{%          endif%}
{%      endif%}
{%  endif%}
{% endfor%}



